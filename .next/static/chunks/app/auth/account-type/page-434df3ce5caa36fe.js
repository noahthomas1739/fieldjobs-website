(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1652],{3494:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(3579),s=a(5695),n=a(2115);let o=()=>{let[e,t]=(0,n.useState)(null),[a,o]=(0,n.useState)(!0),l=(0,s.useRouter)(),u=(0,r.createClientComponentClient)();return(0,n.useEffect)(()=>{(async()=>{try{let{data:{user:e},error:a}=await u.auth.getUser();console.log("Auth check - Full user object:",e),console.log("User metadata:",null==e?void 0:e.user_metadata),t(e),o(!1)}catch(e){console.error("Auth error:",e),o(!1)}})();let{data:{subscription:e}}=u.auth.onAuthStateChange(async(e,a)=>{var r,s;console.log("Auth state changed:",e),console.log("Session user metadata:",null==a||null==(r=a.user)?void 0:r.user_metadata),t(null!=(s=null==a?void 0:a.user)?s:null),o(!1),"SIGNED_OUT"===e&&l.push("/auth/login")});return()=>e.unsubscribe()},[l,u]),{user:e,loading:a,signInWithGoogle:async()=>{try{console.log("Starting Google sign in...");let{data:e,error:t}=await u.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/account-type")}});if(t)throw console.error("Google sign in error:",t),t;return console.log("Google sign in initiated:",e),{data:e,error:null}}catch(e){return console.error("Google sign in failed:",e),{data:null,error:e}}},signInWithEmail:async(e,t)=>{let{data:a,error:r}=await u.auth.signInWithPassword({email:e,password:t});return{data:a,error:r}},signOut:async()=>{await u.auth.signOut(),l.push("/auth/login")},updateUserMetadata:async e=>{try{let{data:a,error:r}=await u.auth.updateUser({data:e});if(r)throw r;let{data:{user:s}}=await u.auth.getUser();return t(s),{data:a,error:null}}catch(e){return console.error("Error updating user metadata:",e),{data:null,error:e}}}}}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},6854:(e,t,a)=>{Promise.resolve().then(a.bind(a,9267))},9267:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(5155),s=a(3494),n=a(5695),o=a(2115),l=a(3579);function u(){var e;let{user:t,loading:a}=(0,s.A)(),u=(0,n.useRouter)(),[i,c]=(0,o.useState)(!1),d=(0,l.createClientComponentClient)();(0,o.useEffect)(()=>{if(!a){var e;t?(null==(e=t.user_metadata)?void 0:e.account_type)&&("employer"===t.user_metadata.account_type?u.push("/employer"):u.push("/dashboard")):u.push("/auth/login")}},[t,a,u]);let h=async e=>{c(!0);try{console.log("Setting account type to:",e);let{error:t}=await d.auth.updateUser({data:{account_type:e}});if(t){console.error("Error updating account type:",t),alert("Error setting account type. Please try again."),c(!1);return}console.log("Account type updated successfully!"),setTimeout(()=>{"employer"===e?u.push("/employer"):u.push("/dashboard")},500)}catch(e){console.error("Error:",e),alert("Something went wrong. Please try again."),c(!1)}};return a?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl mb-4",children:"⏳"}),(0,r.jsx)("div",{children:"Loading..."})]})}):!t||(null==(e=t.user_metadata)?void 0:e.account_type)?null:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Welcome to FieldJobs!"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Choose your account type:"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>h("employer"),disabled:i,className:"w-full p-4 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Setting up...":"I'm an Employer"}),(0,r.jsx)("button",{onClick:()=>h("job_seeker"),disabled:i,className:"w-full p-4 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Setting up...":"I'm Looking for Work"})]}),(0,r.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["Signed in as: ",t.email]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3579,8441,1684,7358],()=>t(6854)),_N_E=e.O()}]);