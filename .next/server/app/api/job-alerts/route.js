(()=>{var e={};e.id=1885,e.ids=[1885],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70164:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>j,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{DELETE:()=>d,GET:()=>l,POST:()=>c,PUT:()=>p});var o=t(96559),n=t(48088),a=t(37719),i=t(61223),u=t(44999);async function l(e){try{let r=(0,u.UL)(),t=(0,i.createRouteHandlerClient)({cookies:()=>r}),{searchParams:s}=new URL(e.url),o=s.get("userId");if(!o)return Response.json({error:"User ID required"},{status:400});let{data:n,error:a}=await t.from("job_alerts").select("*").eq("user_id",o).order("created_at",{ascending:!1});if(a)return console.error("Database error:",a),Response.json({error:"Database error: "+a.message},{status:500});return Response.json({jobAlerts:n})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function c(e){try{let r=(0,u.UL)(),t=(0,i.createRouteHandlerClient)({cookies:()=>r}),{userId:s,name:o,keywords:n,region:a,industry:l,classification:c,salary:p,frequency:d}=await e.json();if(!s||!o||!d)return Response.json({error:"User ID, alert name, and frequency are required"},{status:400});let j=null,m=null;if(p&&p.trim()&&p.includes("-")){let e=p.split("-"),r=e[0]?.replace(/[$\s]/g,""),t=e[1]?.replace(/[$\s]/g,"");r&&!isNaN(r)&&(j=parseInt(r)),t&&!isNaN(t)&&(m=parseInt(t))}let{data:f,error:g}=await t.from("job_alerts").insert([{user_id:s,name:o.trim(),keywords:n?.trim()||"",region:a?.trim()||"",industry:l?.trim()||"",classification:c?.trim()||"",min_salary:j,max_salary:m,frequency:d,active:!0,last_sent:null,matches_count:0,total_sent:0}]).select().single();if(g)return console.error("Error creating job alert:",g),Response.json({error:"Error creating job alert: "+g.message},{status:500});return Response.json({success:!0,jobAlert:f,message:"Job alert created successfully! You'll receive notifications when matching jobs are posted."})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function p(e){try{let r=(0,u.UL)(),t=(0,i.createRouteHandlerClient)({cookies:()=>r}),{alertId:s,userId:o,name:n,keywords:a,region:l,industry:c,classification:p,salary:d,frequency:j,active:m}=await e.json();if(!s||!o)return Response.json({error:"Alert ID and User ID are required"},{status:400});let f={};if(void 0!==n&&(f.name=n.trim()),void 0!==a&&(f.keywords=a?.trim()||""),void 0!==l&&(f.region=l?.trim()||""),void 0!==c&&(f.industry=c?.trim()||""),void 0!==p&&(f.classification=p?.trim()||""),void 0!==j&&(f.frequency=j),void 0!==m&&(f.active=m),void 0!==d){let e=null,r=null;if(d&&d.trim()&&d.includes("-")){let t=d.split("-"),s=t[0]?.replace(/[$\s]/g,""),o=t[1]?.replace(/[$\s]/g,"");s&&!isNaN(s)&&(e=parseInt(s)),o&&!isNaN(o)&&(r=parseInt(o))}f.min_salary=e,f.max_salary=r}let{data:g,error:v}=await t.from("job_alerts").update(f).eq("id",s).eq("user_id",o).select().single();if(v)return console.error("Error updating job alert:",v),Response.json({error:"Error updating job alert: "+v.message},{status:500});return Response.json({success:!0,jobAlert:g})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function d(e){try{let r=(0,u.UL)(),t=(0,i.createRouteHandlerClient)({cookies:()=>r}),{searchParams:s}=new URL(e.url),o=s.get("alertId"),n=s.get("userId");if(!o||!n)return Response.json({error:"Alert ID and User ID are required"},{status:400});let{error:a}=await t.from("job_alerts").delete().eq("id",o).eq("user_id",n);if(a)return console.error("Error deleting job alert:",a),Response.json({error:"Error deleting job alert: "+a.message},{status:500});return Response.json({success:!0})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}let j=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/job-alerts/route",pathname:"/api/job-alerts",filename:"route",bundlePath:"app/api/job-alerts/route"},resolvedPagePath:"/Users/mattiebrooke/fieldjobs-website/app/api/job-alerts/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:g}=j;function v(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,131],()=>t(70164));module.exports=s})();