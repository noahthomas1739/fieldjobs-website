(()=>{var e={};e.id=4622,e.ids=[4622],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},74241:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>g});var i={};t.r(i),t.d(i,{DELETE:()=>d,GET:()=>c,POST:()=>p,PUT:()=>l});var s=t(96559),o=t(48088),n=t(37719),a=t(61223),u=t(44999);async function c(e){try{let r=(0,u.UL)(),t=(0,a.createRouteHandlerClient)({cookies:()=>r}),{searchParams:i}=new URL(e.url),s=i.get("userId"),o=i.get("search")||"",n=i.get("region")||"",c=i.get("jobType")||"",p=i.get("industry")||"";i.get("minSalary"),i.get("maxSalary");let l=i.get("urgent"),d=parseInt(i.get("limit"))||50,m=t.from("jobs").select("*, is_featured, featured_until, is_urgent, urgent_until");m=s?(m=(m=(m=m.eq("employer_id",s)).eq("active",!0)).neq("status","deleted")).order("created_at",{ascending:!1}):(m=m.eq("active",!0)).order("is_featured",{ascending:!1}).order("created_at",{ascending:!1}),s||(o&&(m=m.or(`title.ilike.%${o}%,company.ilike.%${o}%,description.ilike.%${o}%`)),n&&(m=m.eq("region",n)),c&&(m=m.eq("job_type",c)),p&&(m=m.eq("primary_industry",p)),"true"===l&&(m=m.or("urgent.eq.true,is_urgent.eq.true"))),m=m.limit(d);let{data:_,error:g}=await m;if(g)return console.error("Database error:",g),Response.json({error:"Database error: "+g.message},{status:500});let y=new Date,h=_.map(e=>{let r=e.is_featured&&(!e.featured_until||new Date(e.featured_until)>y),t=e.is_urgent&&(!e.urgent_until||new Date(e.urgent_until)>y),i=[];return r&&i.push("featured"),t&&i.push("urgent"),e.urgent&&!t&&i.push("urgent"),e.high_priority&&i.push("high-pay"),e.popular&&i.push("popular"),{id:e.id,title:e.title,company:e.company,region:e.region,hourlyRate:e.hourly_rate,hourly_rate:e.hourly_rate,description:e.description,requirements:e.requirements||"",benefits:e.benefits||"",contactEmail:e.contact_email,contact_email:e.contact_email,contactPhone:e.contact_phone,contact_phone:e.contact_phone,jobType:e.job_type,primaryIndustry:e.primary_industry,type:e.primary_industry,industry:e.primary_industry,classification:e.classification||"intermediate",discipline:"general",duration:e.duration||"",start_date:e.start_date,startDate:e.start_date,postedDays:Math.floor((new Date-new Date(e.created_at))/864e5),badges:i,status:e.status,expiresAt:e.expiry_date,createdAt:e.created_at,created_at:e.created_at,location:e.region,views:e.views||0,employer_id:e.employer_id,isFeatured:r,isUrgent:t,featuredUntil:e.featured_until,urgentUntil:e.urgent_until}});return Response.json({jobs:h,success:!0,total:h.length,count:h.length})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function p(e){try{let r=(0,u.UL)(),t=(0,a.createRouteHandlerClient)({cookies:()=>r}),{employerId:i,userId:s,title:o,company:n,description:c,requirements:p,contactEmail:l,contactPhone:d,region:m,hourlyRate:_,duration:g,startDate:y,endDate:h,applicationDeadline:j,jobType:f,primaryIndustry:v,industry:b,classification:q,benefits:x,urgent:w=!1,highPriority:R=!1,expiresAt:D,isFeatured:E=!1,featuredUntil:I=null,isUrgent:k=!1,urgentUntil:S=null}=await e.json(),U=i||s,L=v||b;if(!U||!o||!n||!c||!l||!m||!_)return Response.json({error:"Missing required fields"},{status:400});let{data:P,error:T}=await t.from("jobs").insert([{employer_id:U,title:o.trim(),company:n.trim(),description:c.trim(),requirements:p||"",contact_email:l.trim(),contact_phone:d||"",region:m,hourly_rate:_,duration:g||"",start_date:y||null,end_date:h||null,application_deadline:j||null,industry:L||"",classification:q||"",benefits:x||"",job_type:function(e){if(!e)return"project-hire";let r=e.toLowerCase();return["in-house","project-hire"].includes(r)?r:({"full time":"in-house","full-time":"in-house",fulltime:"in-house",permanent:"in-house",employee:"in-house",staff:"in-house",contract:"project-hire",contractor:"project-hire",freelance:"project-hire",project:"project-hire",temp:"project-hire",temporary:"project-hire","part time":"project-hire","part-time":"project-hire"})[r]||"project-hire"}(f),primary_industry:L||"",active:!0,urgent:w,high_priority:R,popular:!1,expiry_date:D||new Date(Date.now()+2592e6),payment_type:"single",cost_description:_,status:"active",views:0,is_featured:E,featured_until:I,is_urgent:k,urgent_until:S}]).select().single();if(T)return console.error("Error creating job:",T),Response.json({error:"Error creating job: "+T.message},{status:500});return Response.json({success:!0,job:P,message:"Job posted successfully!"})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{jobId:r,id:t,employerId:i,userId:s,title:o,company:n,description:a,requirements:u,contactEmail:c,contactPhone:p,region:l,hourlyRate:d,duration:m,startDate:_,endDate:g,applicationDeadline:y,industry:h,classification:j,benefits:f,jobType:v,primaryIndustry:b,urgent:q,highPriority:x,active:w,status:R,isFeatured:D,featuredUntil:E,isUrgent:I,urgentUntil:k}=await e.json(),S=r||t,U=i||s;if(!S||!U)return Response.json({error:"Job ID and Employer ID are required"},{status:400});let L={};void 0!==o&&(L.title=o.trim()),void 0!==n&&(L.company=n.trim()),void 0!==a&&(L.description=a.trim()),void 0!==u&&(L.requirements=u),void 0!==c&&(L.contact_email=c.trim()),void 0!==p&&(L.contact_phone=p),void 0!==l&&(L.region=l),void 0!==d&&(L.hourly_rate=d),void 0!==m&&(L.duration=m),void 0!==_&&(L.start_date=_||null),void 0!==g&&(L.end_date=g||null),void 0!==y&&(L.application_deadline=y||null),void 0!==h&&(L.industry=h,L.primary_industry=h),void 0!==j&&(L.classification=j),void 0!==f&&(L.benefits=f),void 0!==v&&(L.job_type=function(e){if(!e)return"project-hire";let r=e.toLowerCase();return["in-house","project-hire"].includes(r)?r:({"full time":"in-house","full-time":"in-house",permanent:"in-house",contract:"project-hire",freelance:"project-hire",temp:"project-hire"})[r]||"project-hire"}(v)),void 0!==b&&(L.primary_industry=b),void 0!==q&&(L.urgent=q),void 0!==x&&(L.high_priority=x),void 0!==w&&(L.active=w),void 0!==R&&(L.status=R),void 0!==D&&(L.is_featured=D),void 0!==E&&(L.featured_until=E),void 0!==I&&(L.is_urgent=I),void 0!==k&&(L.urgent_until=k),L.updated_at=new Date().toISOString();let{data:P,error:T}=await supabase.from("jobs").update(L).eq("id",S).eq("employer_id",U).select().single();if(T)return console.error("Error updating job:",T),Response.json({error:"Error updating job: "+T.message},{status:500});return Response.json({success:!0,job:P})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=new URL(e.url).pathname.split("/"),i=t[t.length-1],s=r.get("jobId")||i,o=r.get("employerId")||r.get("userId");if(console.log("DELETE request:",{jobId:s,employerId:o,url:e.url}),!s||!o)return Response.json({error:"Job ID and Employer ID are required"},{status:400});let{error:n}=await supabase.from("jobs").update({active:!1,status:"deleted",deactivated_date:new Date().toISOString()}).eq("id",s).eq("employer_id",o);if(n)return console.error("Error deleting job:",n),Response.json({error:"Error deleting job: "+n.message},{status:500});return Response.json({success:!0})}catch(e){return console.error("Server error:",e),Response.json({error:"Internal server error"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"/Users/mattiebrooke/fieldjobs-website/app/api/jobs/route.js",nextConfigOutput:"",userland:i}),{workAsyncStorage:_,workUnitAsyncStorage:g,serverHooks:y}=m;function h(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:g})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[4243,131],()=>t(74241));module.exports=i})();