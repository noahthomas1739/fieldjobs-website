(()=>{var e={};e.id=9705,e.ids=[9705],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19715:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>c,serverHooks:()=>j,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var o={};t.r(o),t.d(o,{POST:()=>p});var s=t(96559),i=t(48088),n=t(37719),a=t(32190),l=t(61223),u=t(44999);async function p(e){try{let r=(0,u.UL)(),t=(0,l.createRouteHandlerClient)({cookies:()=>r});console.log("\uD83D\uDE80 Free job creation started");let o=await e.json();console.log("\uD83D\uDCDD Request body:",JSON.stringify(o,null,2));let{userId:s,jobData:i}=o;if(!s)return console.error("❌ Missing userId"),a.NextResponse.json({error:"User ID is required"},{status:400});if(!i)return console.error("❌ Missing jobData"),a.NextResponse.json({error:"Job data is required"},{status:400});let n=["title","company","description"].filter(e=>!i[e]);if(n.length>0)return console.error("❌ Missing job fields:",n),a.NextResponse.json({error:`Missing required fields: ${n.join(", ")}`},{status:400});console.log("✅ Input validation passed"),console.log("\uD83D\uDD0D Checking user eligibility...");let{data:p,error:c}=await t.from("profiles").select("has_used_free_job, id").eq("id",s).single();if(c)return console.error("❌ Profile lookup error:",c),a.NextResponse.json({error:"User not found or database error",details:c.message},{status:404});if(console.log("\uD83D\uDC64 Profile found:",p),p.has_used_free_job)return console.error("❌ User already used free job"),a.NextResponse.json({error:"You have already used your free job posting"},{status:403});console.log("✅ User is eligible for free job");let d=new Date;d.setDate(d.getDate()+30),console.log("\uD83D\uDCC5 Expiration date:",d.toISOString());let f={title:i.title,company:i.company,description:i.description,employer_id:s,is_free_job:!0,free_job_expires_at:d.toISOString(),status:"active",active:!0,created_at:new Date().toISOString(),contact_email:i.contactEmail||i.contact_email||"",hourly_rate:i.hourlyRate||i.hourly_rate||i.salary_range||"Competitive",region:i.region||i.location||"",primary_industry:i.industry||i.primary_industry||i.category||"Technical",cost_description:i.cost_description||"",views:0,urgent:!1,high_pay:!1,popular:!1,is_featured:!1,is_urgent:!1},j=[{job_type:(e=>{if(!e)return"in-house";let r=e.toLowerCase();return["in-house","project-hire"].includes(r)?r:({"full time":"in-house","full-time":"in-house",fulltime:"in-house",permanent:"in-house",employee:"in-house",staff:"in-house",contract:"project-hire",contractor:"project-hire",freelance:"project-hire",project:"project-hire",temp:"project-hire",temporary:"project-hire","part time":"project-hire","part-time":"project-hire"})[r]||"in-house"})(i.job_type||i.jobType),payment_type:"free"},{job_type:"in-house",payment_type:"free"},{job_type:"project-hire",payment_type:"free"},{job_type:"in-house",payment_type:"single"},{job_type:"project-hire",payment_type:"single"}],g=null,y=null;for(let e=0;e<j.length;e++){let r=j[e],o={...f,...r};console.log(`💼 Attempt ${e+1}: Creating job with data:`,JSON.stringify(o,null,2));let{data:s,error:i}=await t.from("jobs").insert(o).select().single();if(i){if(console.error(`❌ Attempt ${e+1} failed:`,i),y=i,"23514"!==i.code)return a.NextResponse.json({error:"Failed to create job posting",details:i.message,hint:i.hint},{status:500});console.log(`🔄 Constraint error, trying next configuration...`);continue}console.log(`✅ Job created successfully on attempt ${e+1}:`,s),g=s;break}if(!g)return console.error("❌ All job creation attempts failed. Last error:",y),a.NextResponse.json({error:"Failed to create job posting - all configurations failed",details:y?.message||"Unknown database constraint error",hint:"Please check database constraints for job_type and payment_type fields"},{status:500});let{error:h}=await t.from("profiles").update({has_used_free_job:!0}).eq("id",s);return h?console.error("⚠️ Profile update error (job still created):",h):console.log("✅ User profile updated"),console.log("\uD83C\uDF89 Free job creation completed successfully"),a.NextResponse.json({success:!0,job:g,expiresAt:d.toISOString(),message:"Congratulations! Your first job is now posted FREE for 30 days!"})}catch(e){return console.error("\uD83D\uDCA5 Unexpected error in free job creation:",e),a.NextResponse.json({error:"Internal server error",details:e.message,stack:void 0},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/free-job/create/route",pathname:"/api/free-job/create",filename:"route",bundlePath:"app/api/free-job/create/route"},resolvedPagePath:"/Users/mattiebrooke/fieldjobs-website/app/api/free-job/create/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:j}=c;function g(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[4243,131,2190],()=>t(19715));module.exports=o})();